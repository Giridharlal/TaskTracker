{"version":3,"sources":["index.js"],"names":["express","require","cors","bcrypt","jwt","open","sqlite3","Cookies","uuidv4","v4","config","app","use","json","dbPath","db","initializeDbAndServer","filename","driver","Database","run","listen","console","log","message","process","exit","authenticateToken","req","res","next","authHeader","headers","token","split","status","send","verify","env","JWT_SECRET","err","user","userId","post","request","response","body","name","email","password","get","existingUser","length","hash","hashedPassword","compare","isPasswordValid","sign","id","title","description","due_date","error","taskId","parseInt","details","all","tasks","put","params","existingTask"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst cors = require('cors');\r\nconst bcrypt = require('bcrypt');\r\nconst jwt = require('jsonwebtoken');\r\nconst { open } = require('sqlite');\r\nconst sqlite3 = require('sqlite3');\r\nconst Cookies = require('cookie-parser');\r\nconst { v4: uuidv4 } = require('uuid');\r\nrequire('dotenv').config();\r\n\r\nconst app = express();\r\napp.use(cors());\r\napp.use(express.json());\r\n\r\nconst dbPath = 'taskTracker.db';\r\nlet db = null;\r\n\r\nconst initializeDbAndServer = async () => {\r\n  try {\r\n    db = await open({\r\n      filename: dbPath,\r\n      driver: sqlite3.Database,\r\n    });\r\n\r\n    // Create the users table if not exists\r\n    await db.run(`CREATE TABLE IF NOT EXISTS users (\r\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      name TEXT NOT NULL,\r\n      email TEXT UNIQUE NOT NULL,\r\n      password TEXT NOT NULL,\r\n      created_at TEXT DEFAULT (datetime('now', 'localtime'))\r\n    );`);\r\n    \r\n    // Create the tasks table if not exists\r\n    await db.run(`CREATE TABLE IF NOT EXISTS tasks (\r\n    id INTEGER PRIMARY KEY AUTOINCREMENT,         \r\n    title TEXT NOT NULL,                          \r\n    description TEXT,                             \r\n    status TEXT CHECK(status IN ('Pending', 'In Progress', 'Completed')) DEFAULT 'Pending',  \r\n    due_date TEXT,                                 \r\n    user_id INTEGER,                               \r\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\r\n    );`);\r\n    \r\n    app.listen(5000, () => {\r\n      console.log('Server is running at http://localhost:5000/');\r\n    });\r\n  } catch (error) {\r\n    console.log(`DB Error: ${error.message}`);\r\n    process.exit(1);\r\n  }\r\n};\r\n\r\ninitializeDbAndServer();\r\n\r\n// Middleware to authenticate JWT Token\r\nconst authenticateToken = (req, res, next) => {\r\n  const authHeader = req.headers['authorization'];\r\n  const token = authHeader && authHeader.split(' ')[1];\r\n  \r\n  if (!token) {\r\n    return res.status(401).send('Invalid JWT Token');\r\n  }\r\n\r\n  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {\r\n    if (err) {\r\n      return res.status(401).send('Invalid JWT Token');\r\n    }\r\n    req.userId = user.userId; \r\n    next();\r\n  });\r\n};\r\n\r\n// API 1: POST /register (User registration)\r\napp.post('/register', async (request, response) => {\r\n  try {\r\n    const { name, email, password } = request.body;\r\n\r\n    const existingUser = await db.get(`SELECT * FROM users WHERE email = ?`, [email]);\r\n\r\n    if (existingUser) {\r\n      return response.status(400).send('User already exists');\r\n    }\r\n\r\n    if (password.length < 5) {\r\n      return response.status(400).send('Password is too short');\r\n    }\r\n\r\n    const hashedPassword = await bcrypt.hash(password, 10);\r\n    await db.run(`INSERT INTO users (name, email, password) VALUES (?, ?, ?)`, [name, email, hashedPassword]);\r\n\r\n    response.status(200).send('User created successfully');\r\n  } catch (error) {\r\n    response.status(500).send('Internal Server Error');\r\n  }\r\n});\r\n\r\n// API 2: POST /login (User login)\r\napp.post('/login', async (request, response) => {\r\n  try {\r\n    const {email, password } = request.body;\r\n\r\n    const user = await db.get(`SELECT * FROM users WHERE email = ?`, [email]);\r\n\r\n    if (!user) {\r\n      return response.status(400).send('Invalid user');\r\n    }\r\n    const isPasswordValid = await bcrypt.compare(password, user.password);\r\n    if (!isPasswordValid) {\r\n      return response.status(400).send('Invalid password');\r\n    }\r\n    const token = jwt.sign({ userId: user.id }, process.env.JWT_SECRET);\r\n    response.status(200).json({ token });\r\n  } catch (error) {\r\n    console.log(error);\r\n    response.status(500).send('Internal Server Error');\r\n  }\r\n});\r\n\r\n// API 3: POST /tasks (Create new task)\r\napp.post('/tasks', authenticateToken, async (request, response) => {\r\n  try {\r\n    const { title, description, due_date, status } = request.body;\r\n    const userId = request.userId; \r\n\r\n    if (!title || !description || !due_date) {\r\n      return response.status(400).json({ error: 'Missing required fields' });\r\n    }\r\n\r\n    const taskId = uuidv4();\r\n    await db.run(`INSERT INTO tasks (id, user_id, title, description, due_date, status) \r\n                  VALUES (?, ?, ?, ?, ?, ?)`, [parseInt(taskId), userId, title, description, due_date, status]);\r\n\r\n    response.status(201).json({ message: 'Task created', taskId, title, description, due_date, status });\r\n  } catch (error) {\r\n    console.error('kjadffjba: ',error);  // Log the error to help with debugging\r\n    response.status(500).json({ error: 'Internal Server Error', details: error.message });\r\n  }\r\n});\r\n\r\n// API 4: GET /tasks (Get all tasks of a user)\r\napp.get('/tasks', authenticateToken, async (request, response) => {\r\n  try {\r\n    const userId = request.userId;\r\n    const tasks = await db.all(`SELECT * FROM tasks WHERE user_id = ?`, [userId]);\r\n    response.json(tasks);\r\n  } catch (error) {\r\n    response.status(500).send('Internal Server Error');\r\n  }\r\n});\r\n\r\n// API 5: PUT /tasks/:id (Update task details)\r\napp.put('/tasks/:id', authenticateToken, async (request, response) => {\r\n  try {\r\n    const { id } = request.params;\r\n    const { title, status, description, due_date } = request.body;\r\n\r\n    const existingTask = await db.get(`SELECT * FROM tasks WHERE id = ?`, [id]);\r\n    if (!existingTask) {\r\n      return response.status(404).send('Task not found');\r\n    }\r\n\r\n    await db.run(`UPDATE tasks SET title = ?, status = ?, description = ?, due_date = ? WHERE id = ?`, \r\n                [title, status, description, due_date, id]);\r\n\r\n    response.send('Task updated');\r\n  } catch (error) {\r\n    response.status(500).send('Internal Server Error');\r\n  }\r\n});\r\n\r\n// API 6: DELETE /tasks/:id (Delete task)\r\napp.delete('/tasks/:id', authenticateToken, async (request, response) => {\r\n  try {\r\n    const { id } = request.params;\r\n    console.log('task ID: ',id);\r\n    const existingTask = await db.get(`SELECT * FROM tasks WHERE id = ?`, [id]);\r\n    if (!existingTask) {\r\n      return response.status(404).send('Task not found');\r\n    }\r\n\r\n    await db.run(`DELETE FROM tasks WHERE id = ?`, [id]);\r\n    response.send('Task deleted');\r\n  } catch (error) {\r\n    response.status(500).send('Internal Server Error');\r\n  }\r\n});\r\n"],"file":"index.dev.js"}